# Google Workspace Activity Log Schema - Gmail
# Compatible with Google SecOps Chronicle WORKSPACE_ACTIVITY parser
# Reference: https://developers.google.com/admin-sdk/reports/reference/rest/v1/activities

schema_version: "1.0"
log_type: "WORKSPACE_ACTIVITY"
source_api: "Google Workspace Admin SDK Reports API v1"
application_name: "gmail"
description: "Google Workspace Activity logs - Gmail events (delivery, spam, settings, user actions)"

output_format: "json"
ecs_compatible: false
chronicle_compatible: true

fields:
  kind:
    type: "constant"
    value: "admin#reports#activity"
    required: true
    description: "Resource type identifier for Google Workspace Activity"

  id:
    type: "object"
    required: true
    description: "Unique identifier for the activity"
    fields:
      time:
        type: "datetime"
        format: "iso8601"
        required: true
        description: "Time of occurrence in ISO 8601 format"

      uniqueQualifier:
        type: "string"
        generator: "number_string"
        params:
          length: 18
        required: true
        description: "Unique qualifier for the event"

      applicationName:
        type: "constant"
        value: "gmail"
        required: true
        description: "Google Workspace application name"

      customerId:
        type: "string"
        generator: "custom_id"
        params:
          prefix: "C"
          length: 8
        required: true
        description: "Unique identifier for customer/organization"

  actor:
    type: "object"
    required: true
    description: "User or application performing the action"
    fields:
      callerType:
        type: "constant"
        value: "USER"
        required: true
        description: "Type of actor performing the action"

      email:
        type: "email"
        generator: "email"
        required: true
        description: "Actor's email address"

      profileId:
        type: "string"
        generator: "number_string"
        params:
          length: 21
        required: true
        description: "Actor's profile ID"

  ipAddress:
    type: "ipv4"
    generator: "ipv4"
    required: true
    description: "IP address of the actor"

  events:
    type: "array"
    required: true
    description: "List of events in this activity"
    min_items: 1
    max_items: 1
    item:
      type: "object"
      fields:
        type:
          type: "string"
          required: true
          description: "Event type category"

        name:
          type: "string"
          required: true
          description: "Event name"

        parameters:
          type: "array"
          required: false
          description: "Additional event-specific parameters"
          item:
            type: "object"
            fields:
              name:
                type: "string"
                required: true
                description: "Parameter name"

              value:
                type: "string"
                required: false
                description: "Parameter value"

              intValue:
                type: "integer"
                required: false
                description: "Parameter value (integer)"

              boolValue:
                type: "boolean"
                required: false
                description: "Parameter value (boolean)"

              multiValue:
                type: "array"
                required: false
                description: "Parameter value (multiple)"
                item:
                  type: "string"

scenarios:
  # ==========================================
  # TRAFFIC - Email delivery events
  # ==========================================

  email_sent:
    events:
      - type: "delivery"
        name: "message_sent"
        parameters:
          - name: "message_id"
            value: "MSG-1234567890"
          - name: "recipient_address"
            value: "recipient@example.com"
          - name: "subject"
            value: "Project Update"
          - name: "has_attachment"
            boolValue: false

  email_received:
    events:
      - type: "delivery"
        name: "message_received"
        parameters:
          - name: "message_id"
            value: "MSG-0987654321"
          - name: "sender_address"
            value: "sender@external.com"
          - name: "subject"
            value: "Inquiry about services"
          - name: "has_attachment"
            boolValue: true

  # ==========================================
  # SPAM/SECURITY - Spam and phishing events
  # ==========================================

  email_spam_user_marked:
    events:
      - type: "spam_classification"
        name: "spam_user_marked"
        parameters:
          - name: "message_id"
            value: "MSG-SPAM-123"
          - name: "sender_address"
            value: "spammer@bad-domain.com"
          - name: "subject"
            value: "You won a prize!"

  email_spam_system_flagged:
    events:
      - type: "spam_classification"
        name: "spam_system_flagged"
        parameters:
          - name: "message_id"
            value: "MSG-SPAM-456"
          - name: "sender_address"
            value: "bot@malware.net"
          - name: "reason"
            value: "reputation"

  email_phishing_identified:
    events:
      - type: "spam_classification"
        name: "phishing_user_marked"
        parameters:
          - name: "message_id"
            value: "MSG-PHISH-789"
          - name: "sender_address"
            value: "ceo@fake-company.com"
          - name: "subject"
            value: "Urgent Wire Transfer"

  email_quarantined:
    events:
      - type: "delivery"
        name: "message_quarantined"
        parameters:
          - name: "message_id"
            value: "MSG-MALWARE-101"
          - name: "reason"
            value: "malware_detected"
      - type: "delivery"
        name: "message_released_from_quarantine"
        parameters:
          - name: "message_id"
            value: "MSG-MALWARE-101"
          - name: "admin_email"
            value: "admin@example.com"


  # ==========================================
  # USER INTERACTION - User actions on emails
  # ==========================================

  attachment_download:
    events:
      - type: "user_action"
        name: "attachment_downloaded"
        parameters:
          - name: "message_id"
            value: "MSG-ATT-789"
          - name: "attachment_name"
            value: "invoice.pdf"
          - name: "attachment_hash"
            value: "a1b2c3d4e5f6g7h8i9j0"

  data_exfiltration:
    events:
      - type: "user_action"
        name: "message_forwarded"
        parameters:
          - name: "message_id"
            value: "MSG-SENSITIVE-001"
          - name: "recipient_address"
            value: "competitor@external.com"
          - name: "subject"
            value: "Q4 Roadmap - Confidential"
      - type: "user_action"
        name: "attachment_downloaded"
        parameters:
          - name: "message_id"
            value: "MSG-SENSITIVE-001"
          - name: "attachment_name"
            value: "customer_list.csv"

  mailbox_cleanup:
    events:
      - type: "user_action"
        name: "message_moved_to_trash"
        parameters:
          - name: "message_id"
            value: "MSG-OLD-111"
      - type: "user_action"
        name: "message_permanently_deleted"
        parameters:
      - type: "user_action"
        name: "message_permanently_deleted"
        parameters:
          - name: "message_id"
            value: "MSG-OLD-222"

  delegate_settings_change:
    events:
      - type: "settings"
        name: "delegate_granted"
        parameters:
          - name: "delegate_email"
            value: "assistant@example.com"
          - name: "delegator_email"
            value: "executive@example.com"

  auto_forwarding_change:
    events:
      - type: "settings"
        name: "auto_forwarding"
        parameters:
          - name: "forwarding_address"
            value: "personal@gmail.com"
          - name: "enabled"
            boolValue: true



correlation:
  - field: "id.customerId"
    scope: "global"
    description: "Same customer ID for all logs from one organization"

  - field: "actor.email"
    scope: "session"
    description: "Same user across related activities"
